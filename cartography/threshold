import numpy as np
import matplotlib.pyplot as plt
from scipy.ndimage import label, center_of_mass

# Generer une image binarisee avec un seuil
threshold_mask = image_array_scaled > (5.0 * sigma)
plt.imshow(threshold_mask, cmap='gray', origin='lower')
plt.title('Thresholded Image')
plt.savefig('Impressive')
plt.show()

# Detection des formes dans l'image
# Utilisation de scipy.ndimage.label pour identifier les zones connectees
structure = np.ones((3, 3), dtype=int)  # Structure pour connexite 8
labeled_array, num_features = label(threshold_mask, structure=structure)

# Afficher les regions detectees
plt.imshow(labeled_array, cmap='nipy_spectral', origin='lower')
plt.title(f'Found {num_features} Regions')
plt.colorbar()
plt.show()

# Calculer les barycentres des regions detectees
formes = []
for i in range(1, num_features + 1):
    region_coords = np.argwhere(labeled_array == i)
    formes.append(region_coords)

# Calcul des coordonnees des barycentres
barycentres = center_of_mass(threshold_mask, labeled_array, range(1, num_features + 1))
print("Coordonnees des barycentres :", barycentres)

# Visualiser les barycentres
plt.imshow(threshold_mask, cmap='gray', origin='lower')
for bary in barycentres:
    plt.plot(bary[1], bary[0], 'ro')  # Notez que matplotlib attend (x, y)
plt.title('Barycentres des Formes')
plt.show()